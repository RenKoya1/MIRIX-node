// MIRIX Prisma Schema
// Converted from Python SQLAlchemy models
// See: MIRIX/mirix/orm/*.py

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  extensions = [pgvector(map: "vector")]
}

// =============================================================================
// ENUMS
// =============================================================================

enum ToolType {
  custom
  mirix_core
  mirix_coder_core
  mirix_memory_core
  mirix_extra
  mirix_mcp
  mirix_multi_agent_core
  user_defined
}

enum ToolSourceType {
  python
  json
}

enum AgentType {
  main_agent
  meta_agent
  sub_agent
  memory_agent
}

enum TraceStatus {
  queued
  processing
  running
  completed
  failed
}

enum ApiKeyStatus {
  active
  revoked
  expired
}

enum ApiKeyPermission {
  all
  restricted
  read_only
}

// =============================================================================
// CORE ENTITIES
// =============================================================================

/// Organization - The highest level entity. All other entities belong to one Organization.
model Organization {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Relationships
  users             User[]
  clients           Client[]
  agents            Agent[]
  tools             Tool[]
  blocks            Block[]
  messages          Message[]
  providers         Provider[]
  files             FileMetadata[]
  cloudFileMappings CloudFileMapping[]

  // Memory relationships
  episodicMemory   EpisodicEvent[]
  semanticMemory   SemanticMemoryItem[]
  proceduralMemory ProceduralMemoryItem[]
  resourceMemory   ResourceMemoryItem[]
  knowledge        KnowledgeItem[]

  // Trace relationships
  memoryQueueTraces MemoryQueueTrace[]
  memoryAgentTraces MemoryAgentTrace[]

  @@map("organizations")
}

/// User - Represents a user within the system
model User {
  id                     String    @id @default(uuid())
  name                   String
  status                 String
  timezone               String
  isAdmin                Boolean   @default(false) @map("is_admin")
  lastSelfReflectionTime DateTime? @map("last_self_reflection_time")
  createdAt              DateTime  @default(now()) @map("created_at")
  updatedAt              DateTime  @updatedAt @map("updated_at")
  isDeleted              Boolean   @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  clientId       String? @map("client_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: Cascade)
  blocks       Block[]
  messages     Message[]

  // Memory relationships
  episodicMemory   EpisodicEvent[]
  semanticMemory   SemanticMemoryItem[]
  proceduralMemory ProceduralMemoryItem[]
  resourceMemory   ResourceMemoryItem[]
  knowledge        KnowledgeItem[]

  @@map("users")
}

/// Client - Represents a client application
model Client {
  id           String    @id @default(uuid())
  name         String
  status       String
  scope        String    @default("read_write")
  email        String?   @unique
  passwordHash String?   @map("password_hash")
  lastLogin    DateTime? @map("last_login")
  credits      Float     @default(10.0)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  isDeleted    Boolean   @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")

  // Relationships
  organization Organization?  @relation(fields: [organizationId], references: [id])
  apiKeys      ClientApiKey[]
  users        User[]
  files        FileMetadata[]
  messages     Message[]

  // Memory relationships
  episodicMemory   EpisodicEvent[]
  semanticMemory   SemanticMemoryItem[]
  proceduralMemory ProceduralMemoryItem[]
  resourceMemory   ResourceMemoryItem[]
  knowledge        KnowledgeItem[]

  @@map("clients")
}

/// ClientApiKey - API key for client authentication
model ClientApiKey {
  id         String           @id @default(uuid())
  apiKeyHash String           @map("api_key_hash")
  name       String?
  status     ApiKeyStatus     @default(active)
  permission ApiKeyPermission @default(all)
  createdAt  DateTime         @default(now()) @map("created_at")
  updatedAt  DateTime         @updatedAt @map("updated_at")
  isDeleted  Boolean          @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  clientId       String  @map("client_id")
  organizationId String? @map("organization_id")
  userId         String? @map("user_id")

  // Relationships
  client Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("client_api_keys")
}

// =============================================================================
// AGENT-RELATED ENTITIES
// =============================================================================

/// Agent - The AI agent entity
model Agent {
  id          String     @id @default(dbgenerated("'agent-' || gen_random_uuid()"))
  agentType   AgentType? @map("agent_type")
  name        String?
  description String?
  parentId    String?    @map("parent_id")
  system      String?    @db.Text

  // Message IDs stored as JSON array
  messageIds Json? @map("message_ids")

  // Configuration stored as JSON
  llmConfig                Json? @map("llm_config")
  topicExtractionLlmConfig Json? @map("topic_extraction_llm_config")
  embeddingConfig          Json? @map("embedding_config")
  toolRules                Json? @map("tool_rules")
  mcpTools                 Json? @map("mcp_tools")
  memoryConfig             Json? @map("memory_config")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  tools        ToolsAgents[]
  coreMemory   Block[]
  messages     Message[]

  // Memory relationships
  episodicMemory   EpisodicEvent[]
  semanticMemory   SemanticMemoryItem[]
  proceduralMemory ProceduralMemoryItem[]
  resourceMemory   ResourceMemoryItem[]
  knowledge        KnowledgeItem[]

  @@map("agents")
}

/// Tool - Available tools that agents can invoke
model Tool {
  id              String         @id @default(uuid())
  name            String
  toolType        ToolType       @default(custom) @map("tool_type")
  returnCharLimit Int?           @map("return_char_limit")
  description     String?
  tags            Json           @default("[]")
  sourceType      ToolSourceType @default(json) @map("source_type")
  sourceCode      String?        @map("source_code") @db.Text
  jsonSchema      Json?          @default("{}") @map("json_schema")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  isDeleted       Boolean        @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  agents       ToolsAgents[]

  @@unique([name, organizationId], name: "uix_name_organization")
  @@map("tools")
}

/// ToolsAgents - Many-to-many relationship between tools and agents
model ToolsAgents {
  agentId String @map("agent_id")
  toolId  String @map("tool_id")

  agent Agent @relation(fields: [agentId], references: [id], onDelete: Cascade)
  tool  Tool  @relation(fields: [toolId], references: [id], onDelete: Cascade)

  @@id([agentId, toolId])
  @@unique([agentId, toolId], name: "unique_agent_tool")
  @@map("tools_agents")
}

/// Block - Core memory blocks for agents
model Block {
  id    String @id @default(uuid())
  label String
  value String @db.Text
  limit Int    @default(2000)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  userId         String  @map("user_id")
  agentId        String? @map("agent_id")

  // Relationships
  organization Organization?  @relation(fields: [organizationId], references: [id])
  user         User           @relation(fields: [userId], references: [id])
  agent        Agent?         @relation(fields: [agentId], references: [id], onDelete: Cascade)
  blocksAgents BlocksAgents[]

  @@unique([id, label], name: "unique_block_id_label")
  @@index([id, label], name: "idx_block_id_label")
  @@map("block")
}

/// BlocksAgents - Many-to-many relationship between blocks and agents
model BlocksAgents {
  agentId    String @map("agent_id")
  blockId    String @map("block_id")
  blockLabel String @map("block_label")

  block Block @relation(fields: [blockId, blockLabel], references: [id, label])

  @@id([agentId, blockId, blockLabel])
  @@unique([agentId, blockLabel], name: "unique_label_per_agent")
  @@unique([agentId, blockId], name: "unique_agent_block")
  @@map("blocks_agents")
}

/// Message - Chat messages
model Message {
  id          String  @id
  role        String
  text        String? @db.Text
  content     Json?
  model       String?
  name        String?
  toolCalls   Json?   @map("tool_calls")
  toolCallId  String? @map("tool_call_id")
  filterTags  Json?   @map("filter_tags")
  otid        String?
  toolReturns Json?   @map("tool_returns")
  groupId     String? @map("group_id")
  senderId    String? @map("sender_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  userId         String  @map("user_id")
  agentId        String  @map("agent_id")
  clientId       String? @map("client_id")
  stepId         String? @map("step_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  agent        Agent         @relation(fields: [agentId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: Cascade)
  step         Step?         @relation(fields: [stepId], references: [id], onDelete: SetNull)

  @@index([agentId, createdAt], name: "ix_messages_agent_created_at")
  @@index([createdAt, id], name: "ix_messages_created_at")
  @@index([clientId, userId], name: "ix_messages_client_user")
  @@index([agentId, clientId, userId], name: "ix_messages_agent_client_user")
  @@map("messages")
}

/// Step - Tracks metadata for agent steps
model Step {
  id                      String  @id @default(dbgenerated("'step-' || gen_random_uuid()"))
  origin                  String?
  providerName            String? @map("provider_name")
  model                   String?
  contextWindowLimit      Int?    @map("context_window_limit")
  completionTokens        Int     @default(0) @map("completion_tokens")
  promptTokens            Int     @default(0) @map("prompt_tokens")
  totalTokens             Int     @default(0) @map("total_tokens")
  completionTokensDetails Json?   @map("completion_tokens_details")
  tags                    Json?
  tid                     String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  providerId     String? @map("provider_id")

  // Relationships
  messages Message[]

  @@map("steps")
}

// =============================================================================
// MEMORY ENTITIES
// =============================================================================

/// EpisodicEvent - Episodic memory events
model EpisodicEvent {
  id         String   @id
  occurredAt DateTime @map("occurred_at")
  lastModify Json     @default("{\"timestamp\": \"\", \"operation\": \"created\"}") @map("last_modify")
  actor      String
  eventType  String   @map("event_type")
  summary    String   @db.Text
  details    String   @db.Text
  filterTags Json?    @map("filter_tags")

  // Embedding configuration and vectors
  embeddingConfig  Json?                        @map("embedding_config")
  detailsEmbedding Unsupported("vector(3072)")? @map("details_embedding")
  summaryEmbedding Unsupported("vector(3072)")? @map("summary_embedding")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  userId         String  @map("user_id")
  agentId        String? @map("agent_id")
  clientId       String? @map("client_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  agent        Agent?        @relation(fields: [agentId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([occurredAt], name: "ix_episodic_memory_occurred_at")
  @@index([organizationId], name: "ix_episodic_memory_organization_id")
  @@index([organizationId, occurredAt], name: "ix_episodic_memory_org_occurred_at")
  @@map("episodic_memory")
}

/// SemanticMemoryItem - Semantic memory entries for general knowledge
model SemanticMemoryItem {
  id         String @id
  name       String
  summary    String @db.Text
  details    String @db.Text
  source     String
  filterTags Json?  @map("filter_tags")
  lastModify Json   @default("{\"timestamp\": \"\", \"operation\": \"created\"}") @map("last_modify")

  // Embedding configuration and vectors
  embeddingConfig  Json?                        @map("embedding_config")
  detailsEmbedding Unsupported("vector(3072)")? @map("details_embedding")
  nameEmbedding    Unsupported("vector(3072)")? @map("name_embedding")
  summaryEmbedding Unsupported("vector(3072)")? @map("summary_embedding")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  userId         String  @map("user_id")
  agentId        String? @map("agent_id")
  clientId       String? @map("client_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  agent        Agent?        @relation(fields: [agentId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([updatedAt], name: "ix_semantic_memory_updated_at")
  @@index([organizationId], name: "ix_semantic_memory_organization_id")
  @@index([organizationId, createdAt], name: "ix_semantic_memory_org_created_at")
  @@map("semantic_memory")
}

/// ProceduralMemoryItem - Procedural memory for workflows and guides
model ProceduralMemoryItem {
  id         String @id
  entryType  String @map("entry_type")
  summary    String @db.Text
  steps      Json
  filterTags Json?  @map("filter_tags")
  lastModify Json   @default("{\"timestamp\": \"\", \"operation\": \"created\"}") @map("last_modify")

  // Embedding configuration and vectors
  embeddingConfig  Json?                        @map("embedding_config")
  summaryEmbedding Unsupported("vector(3072)")? @map("summary_embedding")
  stepsEmbedding   Unsupported("vector(3072)")? @map("steps_embedding")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  userId         String  @map("user_id")
  agentId        String? @map("agent_id")
  clientId       String? @map("client_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  agent        Agent?        @relation(fields: [agentId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([updatedAt], name: "ix_procedural_memory_updated_at")
  @@index([organizationId], name: "ix_procedural_memory_organization_id")
  @@index([organizationId, createdAt], name: "ix_procedural_memory_org_created_at")
  @@map("procedural_memory")
}

/// ResourceMemoryItem - Resource memory for documents and files
model ResourceMemoryItem {
  id           String @id
  title        String
  summary      String @db.Text
  resourceType String @map("resource_type")
  content      String @db.Text
  filterTags   Json?  @map("filter_tags")
  lastModify   Json   @default("{\"timestamp\": \"\", \"operation\": \"created\"}") @map("last_modify")

  // Embedding configuration and vectors
  embeddingConfig  Json?                        @map("embedding_config")
  summaryEmbedding Unsupported("vector(3072)")? @map("summary_embedding")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  userId         String  @map("user_id")
  agentId        String? @map("agent_id")
  clientId       String? @map("client_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  agent        Agent?        @relation(fields: [agentId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([updatedAt], name: "ix_resource_memory_updated_at")
  @@index([organizationId], name: "ix_resource_memory_organization_id")
  @@index([organizationId, createdAt], name: "ix_resource_memory_org_created_at")
  @@map("resource_memory")
}

/// KnowledgeItem - Knowledge memory for credentials and bookmarks
model KnowledgeItem {
  id          String @id
  entryType   String @map("entry_type")
  source      String
  sensitivity String
  secretValue String @map("secret_value") @db.Text
  caption     String @db.Text
  filterTags  Json?  @map("filter_tags")
  lastModify  Json   @default("{\"timestamp\": \"\", \"operation\": \"created\"}") @map("last_modify")

  // Embedding configuration and vectors
  embeddingConfig  Json?                        @map("embedding_config")
  captionEmbedding Unsupported("vector(3072)")? @map("caption_embedding")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  userId         String  @map("user_id")
  agentId        String? @map("agent_id")
  clientId       String? @map("client_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  agent        Agent?        @relation(fields: [agentId], references: [id], onDelete: Cascade)
  client       Client?       @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([updatedAt], name: "ix_knowledge_updated_at")
  @@index([organizationId], name: "ix_knowledge_organization_id")
  @@index([organizationId, createdAt], name: "ix_knowledge_org_created_at")
  @@map("knowledge")
}

// =============================================================================
// TRACING ENTITIES
// =============================================================================

/// MemoryQueueTrace - Tracks queued memory update requests
model MemoryQueueTrace {
  id                   String      @id
  status               TraceStatus @default(queued)
  queuedAt             DateTime    @default(now()) @map("queued_at")
  startedAt            DateTime?   @map("started_at")
  completedAt          DateTime?   @map("completed_at")
  interruptRequestedAt DateTime?   @map("interrupt_requested_at")
  interruptReason      String?     @map("interrupt_reason") @db.Text
  messageCount         Int         @default(0) @map("message_count")
  success              Boolean?
  errorMessage         String?     @map("error_message") @db.Text
  metaAgentOutput      String?     @map("meta_agent_output") @db.Text
  triggeredMemoryTypes Json?       @map("triggered_memory_types")
  memoryUpdateCounts   Json?       @map("memory_update_counts")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  clientId       String? @map("client_id")
  userId         String? @map("user_id")
  agentId        String? @map("agent_id")

  // Relationships
  organization      Organization?      @relation(fields: [organizationId], references: [id])
  memoryAgentTraces MemoryAgentTrace[]

  @@map("memory_queue_traces")
}

/// MemoryAgentTrace - Tracks a single agent run for a queued memory update
model MemoryAgentTrace {
  id                   String      @id
  agentType            String?     @map("agent_type")
  agentName            String?     @map("agent_name")
  status               TraceStatus @default(running)
  startedAt            DateTime    @default(now()) @map("started_at")
  completedAt          DateTime?   @map("completed_at")
  success              Boolean?
  errorMessage         String?     @map("error_message") @db.Text
  assistantMessages    Json?       @map("assistant_messages")
  triggeredMemoryTypes Json?       @map("triggered_memory_types")
  memoryUpdateCounts   Json?       @map("memory_update_counts")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  queueTraceId   String? @map("queue_trace_id")
  parentTraceId  String? @map("parent_trace_id")
  agentId        String? @map("agent_id")

  // Relationships
  organization Organization?         @relation(fields: [organizationId], references: [id])
  queueTrace   MemoryQueueTrace?     @relation(fields: [queueTraceId], references: [id], onDelete: Cascade)
  parentTrace  MemoryAgentTrace?     @relation("TraceHierarchy", fields: [parentTraceId], references: [id], onDelete: SetNull)
  childTraces  MemoryAgentTrace[]    @relation("TraceHierarchy")
  toolCalls    MemoryAgentToolCall[]

  @@map("memory_agent_traces")
}

/// MemoryAgentToolCall - Tracks tool/function calls executed by an agent run
model MemoryAgentToolCall {
  id               String      @id
  toolCallId       String?     @map("tool_call_id")
  functionName     String      @map("function_name")
  functionArgs     Json?       @map("function_args")
  llmCallId        String?     @map("llm_call_id")
  promptTokens     Int?        @map("prompt_tokens")
  completionTokens Int?        @map("completion_tokens")
  cachedTokens     Int?        @map("cached_tokens")
  totalTokens      Int?        @map("total_tokens")
  creditCost       Float?      @map("credit_cost")
  status           TraceStatus @default(running)
  startedAt        DateTime    @default(now()) @map("started_at")
  completedAt      DateTime?   @map("completed_at")
  success          Boolean?
  responseText     String?     @map("response_text") @db.Text
  errorMessage     String?     @map("error_message") @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  agentTraceId String @map("agent_trace_id")

  // Relationships
  agentTrace MemoryAgentTrace @relation(fields: [agentTraceId], references: [id], onDelete: Cascade)

  @@map("memory_agent_tool_calls")
}

// =============================================================================
// FILE-RELATED ENTITIES
// =============================================================================

/// FileMetadata - Metadata for uploaded files
model FileMetadata {
  id                   String  @id @default(uuid())
  sourceId             String? @map("source_id")
  fileName             String? @map("file_name")
  filePath             String? @map("file_path")
  sourceUrl            String? @map("source_url")
  googleCloudUrl       String? @map("google_cloud_url")
  fileType             String? @map("file_type")
  fileSize             Int?    @map("file_size")
  fileCreationDate     String? @map("file_creation_date")
  fileLastModifiedDate String? @map("file_last_modified_date")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")
  clientId       String? @map("client_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])
  client       Client?       @relation(fields: [clientId], references: [id])

  @@map("files")
}

/// CloudFileMapping - Mapping between cloud files and local metadata
model CloudFileMapping {
  id          String @id
  cloudFileId String @map("cloud_file_id")
  localFileId String @map("local_file_id")
  status      String
  timestamp   String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])

  @@map("cloud_file_mapping")
}

/// Provider - LLM provider configuration
model Provider {
  id     String  @id @default(uuid())
  name   String
  apiKey String? @map("api_key")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  isDeleted Boolean  @default(false) @map("is_deleted")

  // Audit fields
  createdById     String? @map("_created_by_id")
  lastUpdatedById String? @map("_last_updated_by_id")

  // Foreign keys
  organizationId String? @map("organization_id")

  // Relationships
  organization Organization? @relation(fields: [organizationId], references: [id])

  @@map("providers")
}
